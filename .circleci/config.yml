version: 2.1
jobs:
  deploy-staging:
    working_directory: ~/repo
    docker:
      - image: circleci/node:stretch
    steps:
      - checkout
      - run:
          name: Install now
          command: npm i now

      - run:
          name: Auth with ZEIT
          command: |
            mkdir ~/.now
            echo $NOW_AUTH_JSON > ~/.now/auth.json
            echo $NOW_CONFIG_JSON > ~/.now/config.json

      - run:
          name: Deploy to staging
          command:
            DEPLOYMENT=$(./node_modules/.bin/now)
            ./node_modules/.bin/now alias set $DEPLOYMENT staging.app.thehumanfactor.ai

workflows:
  version: 2
  build:
    jobs:
      - deploy-staging:
          filters:
            branches:
              only:
                - master
